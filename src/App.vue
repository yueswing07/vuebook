<template>
  <div id='app'>
    <div class='container-fluid'>
      <div class="row">        
        <button class='btn btn-danger' @click='logout()' v-if='loggedIn == true'>Logout</button>
        <firebaselogin v-else></firebaselogin>
      </div>
      <div class='row'>
        <overview :currentuser='user'></overview>
      </div>
      <div class='row'>
        <div class="col-md-12">
          <missedtimes :currentuser='user'></missedtimes>
        </div>
      </div>
      <div class='row'>
        <div class="col-md-12">
          <personalevents :currentuser='user'></personalevents>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <marklist :currentuser='user'></marklist>
        </div>
      </div>
    </div>    
  </div>
</div>
</template>


<script>
  import overview from './components/Overview'
  import missedtimes from './components/MissedTimes.vue'
  import personalevents from './components/EventList'
  import firebaselogin from './components/FirebaseLogin'
  import marklist from './components/MarkList'
  import Helper from './FBHelper.js'
  import User from './User.js'
  import awesome from './awesomeDebug.js'
  import firebase from 'firebase';

  var fbhelper = new Helper();
  var user = ""
  var loggedIn = false

  export default {
    name: 'app',
    components: {
      firebaselogin,
      overview,
      missedtimes,
      personalevents,
      marklist
    },
    methods: {
      logout: function () {
        fbhelper.signOutUser()
      },
      setMissingTimes: function(da){

      }
    },
    watch: {
      user: function(){
        awesome.debug('debug','App.vue','Current user change detected')
      }
    },
    data() {
      return {
        user,
        loggedIn: false
      }
    },
    created(){
      // Valid after page refresh
      firebase.auth().onAuthStateChanged((newUser) => {
        if(newUser){
          this.user = newUser
          this.loggedIn = true
        } else {
          awesome.debug('info','App.vue','User logged out')
          this.user = false
          this.loggedIn = false
        }
      })
    }
  }

</script>

<style scoped>


</style>
